# 认证服务基准测试

> 作者 张磊

## 数据估算

* 注册用户数 R 3500
* 登录用户数据（日志系统获得约400） N
* 登录用户数平均时长（估算4小时） L
* 考察时间长度（估算8小时） T
* 并发用户数估算 C 

  * 公式一：N$\times$L/T ，约等于 200
  * 公式二：R\*(8%~12%)，约等于 280～420
  * 并发用户峰值 C^1=(C+3√C)，约等于 243
* TPS=PV\*0.8/(9\*3600)*3

## 基准测试

> 以下基准测试采用分布式模拟并发，持续120秒

### 首页

| 节点数 | 并发数 | 平均 | 最小 | 最大 | 90th | 95th | 99th | 错误率 | 吞吐率 | 返回量(KB) |
| ---| ---| ---| ---| ---| ---| ---| ---| ---| ---| ---| ---|
| 1 | 100 | 60 | 4 | 1112 | 149 | 195 | 304 | 0 | 214/sec | 1350 |
| 1 | 200 | 150 | 5 | 1977 | 419 | 544 | 814 | 0 | 225/sec | 1418 |
| 1 | 300 | 270 | 5 | 4605 | 823 | 1056 | 1657 | 0 | 222/sec | 53.76 |
| 1 | 500 | 465 | 5 | 6730 | 1351 | 1756 | 2839 | 0 | 211/sec | 1394.58 |
| 1 | 700 | 698 | 5 | 7998 | 2151 | 2491 | 3455 | 0 | 220/sec | 1385.29 |
| 1 | 1000 | 1062 | 5 | 15904 | 3062 | 3979 | 6337 | 0 | 213/sec | 1341.32 |
| 2 | 1000 | 183 | 5 | 8784 | 491 | 951 | 2254 | 0 | 378/sec | 2446.02 |

### 登录

| 节点数 | 并发数 | 平均 | 最小 | 最大 | 90th | 95th | 99th | 错误率 | 吞吐率 | 返回量(KB) |
| ---| ---| ---| ---| ---| ---| ---| ---| ---| ---| ---| ---|
| 1 | 100 | 788 | 27 | 3486 | 1421 | 1651 | 2154 | 0 | 29.5/sec | 1015.96 |
| 1 | 200 | 1613 | 29 | 7548 | 2958 | 3481 | 4681 | 0 | 28.9/sec | 998.23 |
| 2 | 200 | 892 | 26 | 3565 | 1471 | 1700 | 2352 | 0 | 52.1/sec | 1801.89 |

### 认证

| 节点数 | 并发数 | 平均 | 最小 | 最大 | 90th | 95th | 99th | 错误率 | 吞吐率 | 返回量(KB) |
| ---| ---| ---| ---| ---| ---| ---| ---| ---| ---| ---| ---|
| 1 | 100 | 28 | 2 | 929 | 70 | 95 | 163 | 0 | 364.5/sec | 678.13 |
| 1 | 200 | 97 | 2 | 3734 | 255 | 356 | 600 | 0 | 347.9/sec | 647.33 |
| 1 | 300 | 107 | 2 | 2838 | 290 | 404 | 681 | 0 | 361.5/sec | 672.60 |
| 1 | 400 | 191 | 2 | 3434 | 523 | 722 | 1189 | 0 | 360.5/sec | 670.75 |
| 1 | 500 | 258 | 2 | 4767 | 708 | 967 | 1570 | 0 | 354.4/sec | 659.44 |
| 1 | 600 | 353 | 2 | 5360 | 955 | 1295 | 2068 | 0 | 354.4/sec | 659.33 |
| 1 | 800 | 506 | 2 | 8194 | 1332 | 1780 | 2834 | 0 | 343.4/sec | 638.80 |
| 1 | 1000 | 660 | 2 | 9249 | 1707 | 2283 | 3509 | 0 | 333.3/sec | 620.06 |
| 2 | 1000 | 125 | 3 | 12367 | 256 | 624 | 2030 | 0 | 551.9/sec | 1072.51 |

## 总结

* 单点压力90th小于2秒的情况基本可以认为是单点并发基准
* 通过部署集群可以实现扩容